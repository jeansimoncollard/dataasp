YUI.add("flickr-photosets-removePhoto-deletor",function(e,t){"use strict";function n(n,r){var i={full_response:1},s=[],o=n.isMultiplePhotos?"photo_ids":"photo_id",u=n.photoID.split(",").length;return i[o]=n.photoID,i.photoset_id=n.setID,n.includeHiddenSets&&(i.extras="hidden_sets",i.user_id=n.userId),s=[r.callAPI("flickr.photosets.removePhoto",i),r.getModel("set-models",n.setID),r.getModel("sets-models",r.getViewer().nsid,{page:1,perPage:r.flipper.isFlipped("enable-sets-list-loading-fix")?10:500}),r.getModelRegistry("photo-sets-models"),r.getModelRegistry("photo-contexts-models")],n.isMultiplePhotos||s.push(r.getModel("photo-models",n.photoID)),e.Promise.all(s).then(function(e){var t=e[0],r=e[1],i=e[2],s=e[3],o=e[4],a;if(t.stat==="ok"){o.exists(n.photoID)&&o.getValue(n.photoID,"contexts").getFromListByID(n.setID)&&(o.setValue(n.photoID,"totalSets",o.getValue(n.photoID,"totalSets")-u),o.getValue(n.photoID,"contexts").removeFromList(n.setID)),s.exists(n.photoID)&&s.getValue(n.photoID,"sets").getFromListByID(n.setID)&&(s.setValue(n.photoID,"total",s.getValue(n.photoID,"total")-u),s.getValue(n.photoID,"sets").removeFromList(n.setID));if(r){n.isMultiplePhotos?r&&n.updateItemCounts&&(r.setValue("photoCount",r.getValue("photoCount")-n.numberOfPhotosSelected),r.setValue("videoCount",r.getValue("videoCount")-n.numberOfVideosSelected)):(a=e[5],r.hasPhoto(a.getValue("id"))&&r.removePhoto(a),a.getValue("isVideo")?r.setValue("videoCount",r.getValue("videoCount")-u):r.setValue("photoCount",r.getValue("photoCount")-u));if(r.getValue("totalCount")<1)return i.getValue("albumsList").remove(n.setID),r.registry.remove(n.setID),null}return r}},e.FetcherErrorLogger(t))}e.namespace("ModelCreators")["flickr-photosets-removePhoto"]={run:n}},"@VERSION@",{requires:["flickr-promise"],optional:["set-models","photo-models","sets-models","photo-sets-models","photo-contexts-models"]});
YUI.add("flickr-photosets-delete-deletor",function(e,t){"use strict";function n(n,r){return n.photoset_id=n.setID,n.gpCode&&(n.gp_code=n.gpCode),n.gpOwner&&(n.gp_owner=n.gpOwner),n.shareCode&&(n.share_code=n.shareCode),r.callAPI("flickr.photosets.delete",n).then(function(e){if(e.code===1)throw new Error(e)}).catch(e.FetcherErrorLogger(t))}e.namespace("ModelDeletors")["flickr-photosets-delete-deletor"]={run:n}},"@VERSION@",{requires:["flickr-promise"]});
YUI.add("flickr-photosets-getPhotos-fetcher",function(e,t){"use strict";function n(t){t.page=t.page||1,t.perPage=t.perPage||100;var n={extras:e.APIHelper.request.getRebootPhotoExtras(),per_page:t.perPage,page:t.page,get_user_info:1,primary_photo_extras:"url_c, url_h, url_k, url_l, url_m, url_n, url_o, url_q, url_s, url_sq, url_t, url_z, needs_interstitial, can_share",jump_to:t.withPhotoId||""};return t.gpCode&&t.gpCode!==null?(n.gp_code=t.gpCode,n.share_code=t.gpCode,n.gp_owner=t.gpOwner):n.photoset_id=t.id.split("-")[0],t.includeHiddenSets&&(n.extras+=",hidden_sets",n.user_id=t.userId),t.viewAs&&(n.view_as=t.viewAs),t.filter&&(n.privacy_filter=t.filter),n}function r(t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=t[4],a=t[5],f=t[6],l,c,h,p,d,v=[],m=!1,g=!1,y=n.id;l=e.APIHelper.response.parsePerson(r.user),c=s.addOrUpdate(l),h={id:n.id,title:r.photoset.title,description:r.photoset.description,owner:c,primary:r.photoset.primary,primaryPhotoSizes:e.APIHelper.response.parsePrimaryPhotoSizes(r.photoset),isAutoUploadSet:r.photoset.isAutoUploadSet,isSharedEntity:r.photoset.hidden&&r.photoset.hidden===1,photoCount:r.photoset.photoCount,videoCount:r.photoset.videoCount,primaryNeedsInterstitial:r.photoset.needsInterstitial,totalCount:parseInt(r.photoset.photoCount,10)+parseInt(r.photoset.videoCount,10),photoList:[],viewCount:r.photoset.countViews,canShare:r.photoset.canShare,canDownload:r.photoset.canDownload},y&&y!==r.photoset.id&&(h.id=y),r.photoset.isAutoUploadSet==="1"&&(h.canShare=!1),o.exists(n.id)&&(p=o.getValue(n.id,"photoPageList"),m=p.hasMinBoundary?p.hasMinBoundary():!1,g=p.hasMaxBoundary?p.hasMaxBoundary():!1,v=p.getList()),d=e.APIHelper.response.parsePhotos({photos:r.photoset.photo,ownerID:r.photoset.owner,personModelRegistry:s,photoModelRegistry:i,photoEngagementModelRegistry:u,photoStatsModelRegistry:a}),h.photoPageList=e.APIHelper.response.addOrReplaceListByPage({current:v,perPage:n.perPage,pageNum:n.page,hasMax:g,hasMin:m,totalItems:r.photoset.total,newPages:d}),h.photoPageList={perPage:r.photoset.perPage,page:r.photoset.page,pageContent:d,totalItems:r.photoset.total},h.photoList.length&&(h.primary=r.photoset.primary);var b={id:h.id,countPhotosFamily:r.photoset.countPhotosFamily,countPhotosFriend:r.photoset.countPhotosFriend,countPhotosPublic:r.photoset.countPhotosPublic,countPhotosFriendFamily:r.photoset.countPhotosFriendFamily,totalCount:r.photoset.countPhotosAll};return f.exists(b.id)?f.setValues(n.id,b):f.add(b),o.exists(h.id)?o.setValue(n.id,"photoPageList",h.photoPageList):o.add(h),d}function i(n,r){var i=this;return e.Promise.all([r.callAPI("flickr.photosets.getPhotos",this._processParams(n),!0),r.getModelRegistry("photo-models"),r.getModelRegistry("person-models"),r.getModelRegistry("set-models"),r.getModelRegistry("photo-engagement-models"),r.getModelRegistry("photo-stats-models"),r.getModelRegistry("album-privacy-models")]).then(function(e){return i._processResponse(e,n)},e.FetcherErrorLogger(t))}e.namespace("ListFetchers")["flickr-photosets-getPhotos"]={run:i,_processParams:n,_processResponse:r}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["photo-models","person-models","set-models","photo-engagement-models","photo-stats-models"]});
YUI.add("flickr-photosets-getContext-fetcher",function(e,t){"use strict";function n(t,n){var r={extras:e.APIHelper.request.getRebootPhotoExtras(),photo_id:t.photoId,num_prev:t.numNext,num_next:t.numPrev,get_photoset_info:1};return t.gpCode?(r.share_code=t.gpCode,r.share_owner=t.gpOwner,r.gp_code=t.gpCode,r.gp_owner=t.gpOwner):r.photoset_id=t.id,r}function r(t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=t[4],a=t[5],f=[],l=[],c=s.proxy(n.photoId),h,p,d,v,m,g,y=[];return h=r.prevphotos,p=r.nextphotos,l=e.APIHelper.response.parsePhotos({photos:h.photo,personModelRegistry:o,photoModelRegistry:s,photoEngagementModelRegistry:u,photoStatsModelRegistry:a}),f=e.APIHelper.response.parsePhotos({photos:p.photo,personModelRegistry:o,photoModelRegistry:s,photoEngagementModelRegistry:u,photoStatsModelRegistry:a}),m=i.getValue(n.id,"photoContextList"),d=m.hasMinBoundary?m.hasMinBoundary():!1,v=m.hasMaxBoundary?m.hasMaxBoundary():!1,g=m.getList(),y=e.APIHelper.response.addOrReplaceListByContext({model:c,next:l,prev:f.reverse(),current:g,hasMin:d,hasMax:v,numNext:n.numNext,numPrev:n.numPrev}),i.setValue(n.id,"photoContextList",y),{next:l,previous:f.reverse()}}function i(n,r){var i=this;return e.Promise.all([r.callAPI("flickr.photosets.getContext",this._processParams(n,r),!0),r.getModelRegistry("set-models"),r.getModelRegistry("photo-models"),r.getModelRegistry("person-models"),r.getModelRegistry("photo-engagement-models"),r.getModelRegistry("photo-stats-models")]).then(function(e){return i._processResponse(e,n)},function(e){throw e.code===2&&e.message==="Photo not in set"&&(e.notInContext=!0),e}).then(null,e.FetcherErrorLogger(t))}e.namespace("ListFetchers")["flickr-photosets-getContext"]={run:i,_processParams:n,_processResponse:r}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["set-models","photo-models","person-models","photo-engagement-models","photo-stats-models"]});
YUI.add("flickr-photosets-create-creator",function(e,t){"use strict";function n(n,r){var i={},s=[];return i.title=n.title,i.description=n.description,i.primary_photo_id=n.photoID,i.full_result=1,s=[r.callAPI("flickr.photosets.create",i),r.getModelRegistry("set-models"),r.getModel("person-models",r.getViewer().nsid),r.getModel("sets-models",r.getViewer().nsid,{page:1,perPage:r.flipper.isFlipped("enable-sets-list-loading-fix")?10:500}),r.getModelRegistry("photo-sets-models"),r.getModelRegistry("photo-contexts-models")],n.isMultiplePhotos||s.push(r.getModel("photo-models",n.photoID)),e.Promise.all(s).then(function(t){var r=t[0],i=t[1],s=t[2],o=t[3],u=t[4],a=t[5],f,l,c,h,p,d=1;return r.photoset.id?(n.isMultiplePhotos?n.numberOfPhotosSelected+n.numberOfVideosSelected===1?(h=r.photoset.photos,p=r.photoset.videos):r.photoset.photos?(h=r.photoset.photos,p=0):(p=r.photoset.videos,h=0):(l=t[6],h=r.photoset.photos,p=r.photoset.videos),f={id:r.photoset.id,title:r.photoset.title.content,photoPageList:n.isMultiplePhotos?[]:[l],photoContextList:n.isMultiplePhotos?[]:[l],owner:s,primary:r.photoset.primary,primaryPhotoSizes:e.APIHelper.response.parsePrimaryPhotoSizes(r.photoset),isAutoUploadSet:!1,photoCount:h,videoCount:p,totalCount:d,viewCount:r.countViews||0},i.add(f),c=i.proxy(r.photoset.id),o.getValue("albumsList").unshift(c),u.exists(n.photoID)&&!u.getValue(n.photoID,"sets").getFromListByID(c.getValue("id"))&&(u.getValue(n.photoID,"sets").prependToList(c),u.setValue(n.photoID,"total",u.getValue(n.photoID,"total")+1)),a.exists(n.photoID)&&!a.getValue(n.photoID,"contexts").getFromListByID(c.getValue("id"))&&(a.setValue(n.photoID,"totalSets",a.getValue(n.photoID,"totalSets")+1),a.getValue(n.photoID,"contexts").appendToList(c)),c):!1},e.FetcherErrorLogger(t))}e.namespace("ModelCreators")["flickr-photosets-create"]={run:n}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["set-models","photo-models","person-models","sets-models","photo-sets-models","photo-contexts-models"]});
YUI.add("flickr-photosets-createHidden-creator",function(e,t){"use strict";function n(n,r){var i={},s=[];return i.photo_ids=n.photoIds,s=[r.callAPI("flickr.photosets.createHidden",i),r.getModelRegistry("set-models"),r.getModel("person-models",r.getViewer().nsid)],e.Promise.all(s).then(function(e){var t=e[0],n=e[1],r=e[2],i,s;return t.stat==="ok"&&t.photoset.share_code?(i={id:t.photoset.share_code,shareCode:t.photoset.share_code,owner:r,gpCode:t.photoset.share_code,gpOwner:r.getValue("pathAlias")||r.getValue("nsid"),url:t.photoset.url,isAutoUploadSet:!1,isSharedEntity:!0,totalCount:t.photoset.count},n.add(i),s=n.proxy(i.id),s):!1},e.FetcherErrorLogger(t))}e.namespace("ModelCreators")["flickr-photosets-createHidden"]={run:n}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["set-models","photo-models","person-models","sets-models","photo-sets-models","photo-contexts-models"]});
YUI.add("flickr-photosets-editMeta-updater",function(e,t){"use strict";function r(e,t,r){var i=e[0],s=e[1];if(!i.photoset||!i.photoset.title||!i.photoset.description)n.warn("No updated data returned from API.");else{if(!s.exists(t.photosetId))throw new Error("[flickr-photosets-editMeta-updater] - Set model cannot be updated if it does not exist");s.setValues(t.photosetId,{title:i.photoset.title.content,description:i.photoset.description.content})}}function i(n,r){var i={},s=this;return i.photoset_id=n.photosetId,i.title=n.title,i.description=n.description,e.Promise.all([r.callAPI("flickr.photosets.editMeta",i),r.getModelRegistry("set-models")]).then(function(e){s._processResponse(e,n,r)},e.FetcherErrorLogger(t))}var n=require("lib/flog")(t);e.namespace("ModelUpdaters")["flickr-photosets-editMeta"]={run:i,_processResponse:r}},"@VERSION@",{requires:["flickr-promise"]});
YUI.add("flickr-photosets-setPrimaryPhoto-updater",function(e,t){"use strict";function n(n,r){var i={};return i.photoset_id=n.albumId,i.photo_id=n.photoId,r.callAPI("flickr.photosets.setPrimaryPhoto",i).then(null,e.FetcherErrorLogger(t))}e.namespace("ModelUpdaters")["flickr-photosets-setPrimaryPhoto"]={run:n}},"@VERSION@",{requires:["flickr-promise"]});
YUI.add("set-models",function(e,t){function r(e){r.superclass.constructor.call(this,e)}var n=require("lib/flog")(t);e.Models[this.name]=r,e.extend(r,e.FlickrModelRegistry,{langBundles:this.details.langBundles,name:this.name,remote:{read:function(t){return e.ListFetchers["flickr-photosets-getPhotos"].run(t,this.appContext)},create:function(t,n){return e.ModelCreators["flickr-photosets-create"].run(t,n)},createHidden:function(t,n){return e.ModelCreators["flickr-photosets-createHidden"].run(t,n)},addPhoto:function(t,n){return e.ModelCreators["flickr-photosets-addPhoto"].run(t,n)},removePhoto:function(t,n){return e.ModelCreators["flickr-photosets-removePhoto"].run(t,n)},update:function(t,n){return e.ModelUpdaters["flickr-photosets-editMeta"].run({photosetId:t,title:n.title?n.title.newVal:this.getValue(t,"title"),description:n.description?n.description.newVal:this.getValue(t,"description")},this.appContext)},setPrimaryPhoto:function(t,n){return e.ModelUpdaters["flickr-photosets-setPrimaryPhoto"].run(t,n)},"delete":function(t){if(typeof t=="string"){var n=t;t={setID:n}}return e.ModelDeletors["flickr-photosets-delete-deletor"].run(t,this.appContext)}},addPhoto:function(e,t){return this.getValue(e,"photoPageList").hasMaxBoundary()&&this.getValue(e,"photoPageList").appendToList(t),this.getValue(e,"photoContextList").hasMaxBoundary()&&this.getValue(e,"photoContextList").appendToList(t),this},removePhoto:function(e,t){return this.getValue(e,"photoPageList").removeFromList(t.getValue("id")),this.getValue(e,"photoContextList").removeFromList(t.getValue("id")),this},hasPhoto:function(e,t){return this.getValue(e,"photoPageList").getFromListByID(t)||this.getValue(e,"photoContextList").getFromListByID(t)},getSizeToFit:function(t,r,i){n.warn("Using `getSizeToFit` is deprecated. See model comments for more details.");var s=e.PhotoModelHelper.getSizeToFit(t,r,e.merge({sizes:this.getValue(t,"primaryPhotoSizes"),includeSquare:!0,cropToFit:!0},i));return s&&(s.url=s.src),s},getLargestPrimaryPhotoSize:function(t,n){return e.PhotoModelHelper.getLargestSize(t,n)},attributes:{normalizedId:{readOnly:!0,defaultFn:function(e){return e.split("-")[0]}},displayType:{readOnly:!0,defaultFn:function(){return"set"}},title:{validator:function(t,n){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)},defaultValue:""},description:{validator:function(t,n){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)},defaultValue:""},owner:{isModel:!0},isOwner:e.PhotoModelHelper.attributes.isOwner,photoPageList:{isCollection:!0,pageFetch:{listFetcher:e.ListFetchers["flickr-photosets-getPhotos"]}},photoContextList:{isListProxy:!0,contextFetch:{listFetcher:e.ListFetchers["flickr-photosets-getContext"],listItemIdField:"photoId"}},photoCount:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)}},videoCount:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)}},totalCount:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)},defaultFn:function(e){return this.getValue(e,"photoCount")+this.getValue(e,"videoCount")}},viewCount:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)}},photoCountDisplay:{readOnly:!0,derivedBy:["totalCount"],defaultFn:function(e){var t=this.getValue(e,"photoCount"),n=this.getValue(e,"videoCount"),r=this.getValue(e,"totalCount"),i="";return t-=n,t===0&&n===0?i=this.intlMessage({intlName:"models.ZERO_PHOTOS"}):t===1&&n===0?i=this.intlMessage({intlName:"models.ONE_PHOTO"}):t>1&&n===0?i=this.intlMessage({intlName:"models.MULTIPLE_PHOTOS",photos:t}):t===0&&n===1?i=this.intlMessage({intlName:"models.ONE_VIDEO"}):t===1&&n===1?i=this.intlMessage({intlName:"models.ONE_PHOTO_AND_ONE_VIDEO"}):t>1&&n===1?i=this.intlMessage({intlName:"models.MULTIPLE_PHOTOS_AND_ONE_VIDEO",photos:t}):t===0&&n>1?i=this.intlMessage({intlName:"models.MULTIPLE_VIDEOS",videos:n}):t===1&&n>1?i=this.intlMessage({intlName:"models.ONE_PHOTO_AND_MULTIPLE_VIDEOS",videos:n}):t>1&&n>1&&(i=this.intlMessage({intlName:"models.MULTIPLE_PHOTOS_AND_MULTIPLE_VIDEOS",photos:t,videos:n})),r===0?i=this.intlMessage({intlName:"models.ZERO_ITEMS"}):r===1?i=this.intlMessage({intlName:"models.ONE_ITEM"}):r>1&&(i=this.intlMessage({intlName:"models.MULTIPLE_ITEMS",items:r})),i}},photoAndVideosDisplay:{readOnly:!0,derivedBy:["photoCount","videoCount"],defaultFn:function(e){var t=this.getValue(e,"photoCount"),n=this.getValue(e,"videoCount"),r="";return t===0&&n===0?r=this.intlMessage({intlName:"models.ZERO_PHOTOS"}):t===1&&n===0?r=this.intlMessage({intlName:"models.ONE_PHOTO"}):t>1&&n===0?r=this.intlMessage({intlName:"models.MULTIPLE_PHOTOS",photos:t}):t===0&&n===1?r=this.intlMessage({intlName:"models.ONE_VIDEO"}):t===1&&n===1?r=this.intlMessage({intlName:"models.ONE_PHOTO_AND_ONE_VIDEO"}):t>1&&n===1?r=this.intlMessage({intlName:"models.MULTIPLE_PHOTOS_AND_ONE_VIDEO",photos:t}):t===0&&n>1?r=this.intlMessage({intlName:"models.MULTIPLE_VIDEOS",videos:n}):t===1&&n>1?r=this.intlMessage({intlName:"models.ONE_PHOTO_AND_MULTIPLE_VIDEOS",videos:n}):t>1&&n>1&&(r=this.intlMessage({intlName:"models.MULTIPLE_PHOTOS_AND_MULTIPLE_VIDEOS",photos:t,videos:n})),r}},sharedEntityDisplay:{readOnly:!0,derivedBy:["videoCount","photoCount"],defaultFn:function(e){var t=this.getValue(e,"photoCount"),n=this.getValue(e,"videoCount"),r=this.getValue(e,"owner"),i="";return t&&!n?i=this.intlMessage({intlName:"shared-entity.USERNAME_HAS_SHARED_PHOTOS_ONLY",username:r.getValue("displayname"),photoCount:parseInt(t,10)}):!t&&n?i=this.intlMessage({intlName:"shared-entity.USERNAME_HAS_SHARED_VIDEOS_ONLY",username:r.getValue("displayname"),videoCount:parseInt(n,10)}):t&&n&&(i=this.intlMessage({intlName:"shared-entity.USERNAME_HAS_SHARED_PHOTOS_VIDEOS"
,username:r.getValue("displayname"),photoCount:parseInt(t,10),videoCount:parseInt(n,10)})),i}},primary:{},primaryPhotoSizes:{},primaryNeedsInterstitial:{},bestIconURL:{readOnly:!0,derivedBy:["primaryPhotoSizes"],defaultFn:function(t){var n=e.PhotoModelHelper.getSizeToFit(t,{height:48,width:48},e.merge({sizes:this.getValue(t,"primaryPhotoSizes"),includeSquare:!0,cropToFit:!0}));return n?n.src:""}},url:{readOnly:!0,derivedBy:["owner","normalizedId"],defaultFn:function(e){var t=this.getValue(e,"owner"),n=this.getValue(e,"isSharedEntity"),r=this.getValue(e,"normalizedId");return t&&n===!0?"/photos/"+t.getValue("pathAlias")+"/shares/"+r:t?"/photos/"+t.getValue("pathAlias")+"/albums/"+r:undefined}},isAutoUploadSet:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},isSharedEntity:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},canShare:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},canDownload:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},urlSuffix:{readOnly:!0,defaultFn:function(e){var t=this.getValue(e,"isSharedEntity");return t?"shares-"+e:"album-"+e}},gpCode:{defaultFn:function(e){return null}},gpOwner:{defaultFn:function(e){return null}}}},{buildCompoundId:function(e,t,n){var r=e;return t&&(r+="-"+t),n&&(t||(r+="-dateposted"),r+="-"+n),r},splitCompoundId:function(e){var t=e.split("-");return{nsid:t[0],orderBy:t[1],viewAs:t[2]}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-promise","flickr-photosets-addPhoto-creator","flickr-photosets-removePhoto-deletor","flickr-photosets-delete-deletor","flickr-photosets-getPhotos-fetcher","flickr-photosets-getContext-fetcher","flickr-photosets-create-creator","flickr-photosets-createHidden-creator","flickr-photosets-editMeta-updater","flickr-photosets-setPrimaryPhoto-updater","photo-model-helper"],langBundles:["models","shared-entity"]});
YUI.add("photo-groups-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ModelFetchers["flickr-photos-getAllContexts"].run(t,this.appContext)}},attributes:{id:{},groups:{isCollection:!0},total:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)},defaultValue:0}}})},"@VERSION@",{requires:["api-helper","flickr-model-registry","flickr-promise","flickr-photos-getAllContexts-fetcher"]});
YUI.add("flickr-photos-getAllContexts-fetcher",function(e,t){"use strict";function n(t){var n;return n={photo_id:t.id,extras:e.APIHelper.request.getRebootPhotoExtras()+","+e.APIHelper.request.getRebootGroupExtras()+","+e.APIHelper.request.getRebootAlbumsListExtras(),primary_photo_extras:"url_sq, url_t, url_s, url_m, needs_interstitial"},t.scrappy&&(n.get_all_galleries=1,n.no_faves_context=1,n.per_type_limit=6,n.get_totals=1,n.sort="date-desc"),n}function r(t,n){var r=t[0],i=t[1],s=t[2],o={},u=[],a,f=t[8],l=t[9],c=t[10],h=t[11],p;return o.faves=t[3],o.gallery=t[4],o.pool=t[5],o.set=t[6],o.stream=t[7],e.Object.each(o,function(t,n){r[n]&&e.Array.each(r[n],function(n){e.APIHelper.response.addContextToRegistry(n,t,i,h),u.push(t.proxy(n.id))})}),s.exists(n.id)||(a=s.add({id:n.id,totalGroups:r.totals&&r.totals.groups,totalSets:r.totals&&r.totals.sets,totalGalleries:r.totals&&r.totals.galleries}),s.setValue(n.id,"contexts",u)),f.addOrUpdate({id:n.id,total:r.totals&&r.totals.groups,groups:s.getContextsOfType(n.id,"group-pool-models")}),p=s.getContextsOfType(n.id,"set-models"),p.forEach(function(e){e.setValue("totalCount",parseInt(e.getValue("photoCount"),10)+parseInt(e.getValue("videoCount"),10))}),l.addOrUpdate({id:n.id,total:r.totals&&r.totals.sets,sets:p}),c.addOrUpdate({id:n.id,total:r.totals&&r.totals.galleries,galleries:s.getContextsOfType(n.id,"gallery-models")}),a}function i(n,r){var i=this;return r.flipper.isFlipped("enable-scrappy-photo-page")&&(n.scrappy=!0),e.Promise.all([r.callAPI("flickr.photos.getAllContexts",this._processParams(n),!0),r.getModelRegistry("person-models"),r.getModelRegistry("photo-contexts-models"),r.getModelRegistry("favorite-models"),r.getModelRegistry("gallery-models"),r.getModelRegistry("group-pool-models"),r.getModelRegistry("set-models"),r.getModelRegistry("photostream-models"),r.getModelRegistry("photo-groups-models"),r.getModelRegistry("photo-sets-models"),r.getModelRegistry("photo-galleries-models"),r.getModelRegistry("group-models")]).then(function(e){return i._processResponse(e,n)},e.FetcherErrorLogger(t))}e.namespace("ModelFetchers")["flickr-photos-getAllContexts"]={run:i,_processParams:n,_processResponse:r}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["photo-contexts-models","favorite-models","gallery-models","group-pool-models","photostream-models","set-models","photo-groups-models","photo-sets-models","photo-galleries-models","group-models"]});
YUI.add("photo-galleries-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ModelFetchers["flickr-photos-getAllContexts"].run(t,this.appContext)}},attributes:{id:{},galleries:{isListProxy:!0},total:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)},defaultValue:0}}})},"@VERSION@",{requires:["api-helper","flickr-model-registry","flickr-promise","flickr-photos-getAllContexts-fetcher"]});
YUI.add("flickr-galleries-addPhoto-creator",function(e,t){"use strict";function n(n,r){var i={},s=n.galleryCompoundID.split("-").pop();return i.photo_id=n.photoID,i.gallery_id=n.galleryCompoundID,e.Promise.all([r.callAPI("flickr.galleries.addPhoto",i),r.getModel("gallery-models",s),r.getModel("photo-models",n.photoID),r.getModelRegistry("photo-galleries-models"),r.getModelRegistry("photo-contexts-models")]).then(function(t){var r=t[0],i=t[1],o=t[2],u=t[3],a=t[4],f,l;if(r.stat==="ok")return i&&!i.hasPhoto(o.getValue("id"))&&(i.addPhoto(o),o.getValue("isVideo")?i.setValue("videoCount",i.getValue("videoCount")+1):i.setValue("photoCount",i.getValue("photoCount")+1),1===i.getValue("photoCount")+i.getValue("videoCount")&&(f=o.getValue("sizes"),l={},e.Object.each(f,function(e,t){["m","s","sq","t"].indexOf(t)>-1&&(l[t]={width:e.width,height:e.height,src:e.url})}),i.setValue("primary",s),i.setValue("primaryPhotoSizes",l))),u.exists(n.photoID)&&!u.getValue(n.photoID,"galleries").getFromListByID(i.getValue("id"))&&(u.getValue(n.photoID,"galleries").prependToList(i),u.setValue(n.photoID,"total",u.getValue(n.photoID,"total")+1)),a.exists(n.photoID)&&!a.getValue(n.photoID,"contexts").getFromListByID(i.getValue("id"))&&(a.setValue(n.photoID,"totalGalleries",a.getValue(n.photoID,"totalGalleries")+1),a.getValue(n.photoID,"contexts").appendToList(i)),i},e.FetcherErrorLogger(t))}e.namespace("ModelCreators")["flickr-galleries-addPhoto"]={run:n}},"@VERSION@",{requires:["flickr-promise"],optional:["gallery-models","photo-models","photo-galleries-models","photo-contexts-models"]});
YUI.add("flickr-galleries-removePhoto-deletor",function(e,t){"use strict";function n(n,r){var i={},s=n.galleryCompoundID.split("-").pop();return i.photo_id=n.photoID,i.gallery_id=n.galleryCompoundID,e.Promise.all([r.callAPI("flickr.galleries.removePhoto",i),r.getModel("gallery-models",s),r.getModel("photo-models",n.photoID),r.getModelRegistry("photo-galleries-models"),r.getModelRegistry("photo-contexts-models")]).then(function(e){var t=e[0],r=e[1],i=e[2],o=e[3],u=e[4];if(t.stat==="ok")return u.exists(n.photoID)&&u.getValue(n.photoID,"contexts").getFromListByID(s)&&(u.setValue(n.photoID,"totalGalleries",u.getValue(n.photoID,"totalGalleries")-1),u.getValue(n.photoID,"contexts").removeFromList(s)),o.exists(n.photoID)&&o.getValue(n.photoID,"galleries").getFromListByID(s)&&(o.setValue(n.photoID,"total",o.getValue(n.photoID,"total")-1),o.getValue(n.photoID,"galleries").removeFromList(s)),r&&(r.hasPhoto(i.getValue("id"))&&r.removePhoto(i),i.getValue("isVideo")?r.setValue("videoCount",r.getValue("videoCount")-1):r.setValue("photoCount",r.getValue("photoCount")-1),0===r.getValue("photoCount")+r.getValue("videoCount")&&(r.setValue("primary",null),r.setValue("primaryPhotoSizes",{}))),r},e.FetcherErrorLogger(t))}e.namespace("ModelCreators")["flickr-galleries-removePhoto"]={run:n}},"@VERSION@",{requires:["flickr-promise"],optional:["gallery-models","photo-models","photo-galleries-models","photo-contexts-models"]});
YUI.add("flickr-galleries-getList-fetcher",function(e,t){"use strict";function n(t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=r.galleries,a=n.id,f,l={},c=[];u&&(f=o.exists(a)?o.proxy(a):o.add(a),u.gallery&&e.Array.each(u.gallery,function(t,n){var r,i;r=t.id.split("-")[1],i={id:r,compoundId:t.id,title:t.title.content,description:t.description.content,owner:f,primary:t.primaryPhotoId,primaryPhotoSizes:e.APIHelper.response.parsePrimaryPhotoSizes(t),photoCount:t.countPhotos,videoCount:t.countVideos},c.push(s.addOrUpdate(i))}),l={id:a,galleries:c},i.exists(a)?i.setValues(a,l):i.add(l))}function r(n,r){var i=this,s={user_id:n.id,primary_photo_extras:"url_sq, url_t, url_s, url_m"};return e.Promise.all([r.callAPI("flickr.galleries.getList",s),r.getModelRegistry("person-galleries-models"),r.getModelRegistry("gallery-models"),r.getModelRegistry("person-models")]).then(function(e){i._processResponse(e,n)},e.FetcherErrorLogger(t))}e.namespace("ListFetchers")["flickr-galleries-getList"]={run:r,_processResponse:n}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["person-galleries-models","gallery-models","person-models"]});
YUI.add("person-galleries-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ListFetchers["flickr-galleries-getList"].run(t,this.appContext)}},attributes:{id:{},galleries:{isListProxy:!0}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-promise","flickr-galleries-getList-fetcher"]});
YUI.add("flickr-galleries-create-creator",function(e,t){"use strict";function n(n,r){var i={};return i.title=n.title,i.description=n.description,i.primary_photo_id=n.photoID,i.full_result=1,e.Promise.all([r.callAPI("flickr.galleries.create",i),r.getModelRegistry("gallery-models"),r.getModel("photo-models",n.photoID),r.getModel("person-models",r.getViewer().nsid),r.getModel("person-galleries-models",r.getViewer().nsid),r.getModelRegistry("photo-galleries-models"),r.getModelRegistry("photo-contexts-models")]).then(function(t){var r=t[0],i=t[1],s=t[2],o=t[3],u=t[4],a=t[5],f=t[6],l,c=r.gallery.id,h=c.split("-")[1];return h?(l=i.add({id:h,compoundId:c,title:r.gallery.title.content,description:r.gallery.description.content,photoPageList:[s],photoContextList:[s],owner:o,primary:n.photoID,primaryPhotoSizes:e.APIHelper.response.parsePrimaryPhotoSizes(r.gallery),photoCount:s.getValue("isVideo")?0:1,videoCount:s.getValue("isVideo")?1:0}),u.getValue("galleries").prependToList(l),a.exists(n.photoID)&&!a.getValue(n.photoID,"galleries").getFromListByID(l.getValue("id"))&&(a.getValue(n.photoID,"galleries").prependToList(l),a.setValue(n.photoID,"total",a.getValue(n.photoID,"total")+1)),f.exists(n.photoID)&&!f.getValue(n.photoID,"contexts").getFromListByID(l.getValue("id"))&&(f.setValue(n.photoID,"totalGalleries",f.getValue(n.photoID,"totalGalleries")+1),f.getValue(n.photoID,"contexts").appendToList(l)),l):!1},e.FetcherErrorLogger(t))}e.namespace("ModelCreators")["flickr-galleries-create"]={run:n}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["gallery-models","photo-models","person-models","person-galleries-models","photo-galleries-models","photo-contexts-models"]});
YUI.add("gallery-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{langBundles:this.details.langBundles,name:this.name,remote:{read:function(t){return e.ListFetchers["flickr-galleries-getPhotos"].run(t,this.appContext)},create:function(t,n){return e.ModelCreators["flickr-galleries-create"].run(t,n)},addPhoto:function(t,n){return e.ModelCreators["flickr-galleries-addPhoto"].run(t,n)},removePhoto:function(t,n){return e.ModelCreators["flickr-galleries-removePhoto"].run(t,n)}},addPhoto:function(e,t){return this.getValue(e,"photoPageList").hasMaxBoundary()&&this.getValue(e,"photoPageList").appendToList(t),this.getValue(e,"photoContextList").hasMaxBoundary()&&this.getValue(e,"photoContextList").appendToList(t),this},removePhoto:function(e,t){return this.getValue(e,"photoPageList").removeFromList(t.getValue("id")),this.getValue(e,"photoContextList").removeFromList(t.getValue("id")),this},hasPhoto:function(e,t){return this.getValue(e,"photoPageList").getFromListByID(t)||this.getValue(e,"photoContextList").getFromListByID(t)},attributes:{compoundId:{validator:function(t,n){return e.Lang.isString(t)&&t.indexOf("-")>-1}},displayType:{readOnly:!0,defaultFn:function(){return"gallery"}},title:{validator:function(t,n){return e.AttributeHelpers.validateString(t)},setter:function(t){var n=e.AttributeHelpers.coerceString(t);return n=n.replace(/\\'/,"'").replace(/\\"/,'"').replace(/\\\\/,"\\"),n},defaultValue:""},description:{validator:function(t,n){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)},defaultValue:""},owner:{isModel:!0},photoPageList:{isListProxy:!0,pageFetch:{listFetcher:e.ListFetchers["flickr-galleries-getPhotos"]}},photoContextList:{isListProxy:!0,contextFetch:{listFetcher:e.ListFetchers["flickr-galleries-getContext"],listItemIdField:"photoId"}},photoCount:{validator:function(t,n){return e.AttributeHelpers.validateInteger(t)},setter:function(t,n){return e.AttributeHelpers.coerceInteger(t)}},videoCount:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)}},photoCountDisplay:{readOnly:!0,derivedBy:["owner"],defaultFn:function(e){var t=this.getValue(e,"photoCount"),n=this.getValue(e,"videoCount"),r="";return t-=n,t===0&&n===0?r=this.intlMessage({intlName:"models.ZERO_PHOTOS"}):t===1&&n===0?r=this.intlMessage({intlName:"models.ONE_PHOTO"}):t>1&&n===0?r=this.intlMessage({intlName:"models.MULTIPLE_PHOTOS",photos:t}):t===0&&n===1?r=this.intlMessage({intlName:"models.ONE_VIDEO"}):t===1&&n===1?r=this.intlMessage({intlName:"models.ONE_PHOTO_AND_ONE_VIDEO"}):t>1&&n===1?r=this.intlMessage({intlName:"models.MULTIPLE_PHOTOS_AND_ONE_VIDEO",photos:t}):t===0&&n>1?r=this.intlMessage({intlName:"models.MULTIPLE_VIDEOS",videos:n}):t===1&&n>1?r=this.intlMessage({intlName:"models.ONE_PHOTO_AND_MULTIPLE_VIDEOS",videos:n}):t>1&&n>1&&(r=this.intlMessage({intlName:"models.MULTIPLE_PHOTOS_AND_MULTIPLE_VIDEOS",photos:t,videos:n})),r}},primary:{},primaryPhotoSizes:{},bestIconURL:{readOnly:!0,derivedBy:["primaryPhotoSizes"],defaultFn:function(e){var t=this.getValue(e,"primaryPhotoSizes");return t&&t.sq?t.sq.src:undefined}},url:{readOnly:!0,derivedBy:["owner"],defaultFn:function(e){var t=this.getValue(e,"owner");return t?"/photos/"+t.getValue("pathAlias")+"/galleries/"+e+"/":undefined}},urlSuffix:{readOnly:!0,derivedBy:["owner"],defaultFn:function(e){var t=this.getValue(e,"owner"),n=t.getValue("pathAlias");return"gallery-"+n+"-"+e}}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-promise","flickr-galleries-getPhotos-fetcher","flickr-galleries-getContext-fetcher","flickr-galleries-addPhoto-creator","flickr-galleries-removePhoto-deletor","flickr-galleries-create-creator"],langBundles:["models"]});
YUI.add("flickr-galleries-getPhotos-fetcher",function(e,t){"use strict";function n(t){var n={gallery_id:t.compoundId,extras:e.APIHelper.request.getRebootPhotoExtras(),per_page:t.perPage||1,page:t.page||20,get_user_info:1,get_gallery_info:1,primary_photo_extras:"url_sq, url_t, url_s, url_m"};return n}function r(t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=t[4],a=t[5],f;if(r&&r.gallery)return r.gallery.owner=r.user,r.gallery.title=r.gallery.title&&r.gallery.title.content,r.gallery.description=r.gallery.description&&r.gallery.description.content,r.gallery.photoCount=r.gallery.countPhotos,r.gallery.videoCount=r.gallery.countVideos,e.APIHelper.response.addContextToRegistry(r.gallery,o,s),f=e.APIHelper.response.parsePhotos({photos:r.photos.photo,personModelRegistry:s,photoModelRegistry:i,photoEngagementModelRegistry:u,photoStatsModelRegistry:a}),o.setValue(n.id,"photoPageList",f),f}function i(n,r){var i=this;return e.Promise.all([r.callAPI("flickr.galleries.getPhotos",this._processParams(n),!0),r.getModelRegistry("photo-models"),r.getModelRegistry("person-models"),r.getModelRegistry("gallery-models"),r.getModelRegistry("photo-engagement-models"),r.getModelRegistry("photo-stats-models")]).then(function(e){return i._processResponse(e,n)},e.FetcherErrorLogger(t))}e.namespace("ListFetchers")["flickr-galleries-getPhotos"]={run:i,_processResponse:r,_processParams:n}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["photo-models","person-models","gallery-models","photo-engagement-models","photo-stats-models"]});
YUI.add("notifications-view",function(e,t){var n=require("lib/flog")(t);e.namespace("Views")[this.name]=e.Base.create("notifications-view",e.FlickrView,[],{langBundles:this.details.langBundles,registries:{person:"person-models",photo:"photo-models",group:"group-info-models",gallery:"gallery-models"},initializer:function(e){var t=this.appContext.getViewer();return this.get("container").get("innerHTML")===""&&this.setContainerHTML(""),this.nsid=t&&t.signedIn?t.nsid:undefined,e.nsid=this.nsid,this.pageNum=0,this.pageSize=30,this.isFetchingNotifs=!1,this.scrollBottomLoadDist=300,this.endOfNotifs=!1,this.shouldFetchNotifs=e.shouldFetchNotifs,this.height=e.height,this.width=e.width,this.listHeight=e.listHeight,this.overflowX=e.overflowX,this.overflowY=e.overflowY,this.notifFilter=e.notifFilter,this},loadState:function(){return this},buildContainer:function(){var e=this;return this.setContainerWithTemplate("notifications",{notifications:[],height:e.height,width:e.width,listHeight:e.listHeight,overflowX:e.overflowX,overflowY:e.overflowY}),this},activate:function(){var e=this,t,n,r,i,s;return e.scrollContainer=e.get("container").one(".notifications-list"),e.scrollContainerElement=this.scrollContainer.getDOMNode(),this.registerEventHandler(e.scrollContainer.on("scroll",e.handleScrollNotifications.bind(e))),this.registerEventHandler(e.scrollContainer.on("mousewheel",e.preventParentScroll.bind(e))),e.get("personNotificationsModels")?e.getMoreNotifications():(t=this.appContext.getViewer(),this.appContext.getModel("person-notifications-models",t.nsid).then(function(t){e.set("personNotificationsModels",t),r=t.getValue("notifications").size(),i=t.getValue("unseenNotificationCount"),e.shouldFetchNotifs&&i!==0||r===0||t.getValue("muteChanged")?(e.shouldFetchNotifs=!1,t.setValue("unseenNotificationCount",0),t.setValue("muteChanged",!1),e.get("container").one(".notifications-list").addClass("loading"),e.getMoreNotifications()):(s=t.getValue("notifications").getList(),e.pageNum=Math.floor(r/e.pageSize),e.appendPage(s)),n=t.getValue("unreadFlickrMailCount"),n&&n!==0&&e.get("container").one(".flickr-mail-count").setHTML(e.intlMessage({intlName:"notifications.FLICKR_MAIL_COUNT_PAREN",count:n}))})),this},handleScrollNotifications:function(e){if(this.isFetchingNotifs)return;this.scrollContainerElement.offsetHeight+this.scrollContainerElement.scrollTop+this.scrollBottomLoadDist>=this.scrollContainerElement.scrollHeight&&this.getMoreNotifications()},preventParentScroll:function(e){var t=e.target.ancestor(".notifications-list"),n,r;if(!t)return;n=e.wheelDelta<0,r=t.getDOMNode(),(r.scrollTop<=0&&!n||r.scrollTop+r.offsetHeight>=r.scrollHeight&&n)&&e.preventDefault()},getMoreNotifications:function(){var e=this;e.endOfNotifs||(e.isFetchingNotifs=!0,e.showBalls(e.get("container").one(".notifications-list")),e.retrieveNotifsPage())},appendPage:function(t){var n=this;t.forEach(function(t){var r=t.toJSON(),i;r.appContext=n.appContext,r.notifModel=n.get("personNotificationsModels");if(!r.events||r.events.length===0)return;i=new e.Views["notification-view"](r),i.initialize(r).then(function(i){var s=e.Node.create('<li class="notification-list-item"></li>');n.get("container").one(".notifications-list").append(s),r.seen||s.addClass("unseen"),s.setHTML(i.get("container")),t.setValue("seen",!0),i.activate()})})},showBalls:function(t){this.balls||(this.balls=e.Node.create('<li class="loading-balls"></li>'),this.balls.setHTML(this.templates("flickr-balls")({}))),(t||this.get("container")).append(this.balls)},hideBalls:function(){this.balls&&this.balls.remove()},retrieveNotifsPage:function(){var e=this,t=e.get("personNotificationsModels");return t.getValue("notifications").getPage({page:e.pageNum+1,apiParams:{filter:e.notifFilter}}).then(function(n){return n.length!==0?(e.pageNum++,e.set("personNotifications",t.getValue("notifications")),e.appendPage(n)):(e.pageNum===0&&e.get("container").one(".notifications-empty-state").removeClass("hidden"),e.endOfNotifs=!0),e.get("container").one(".notifications-list").removeClass("loading"),e.hideBalls(),e.isFetchingNotifs=!1,e},function(e){}).then(function(e){e.registerEventHandler(e.get("container").all("a").on("focus",function(t){var n=t.target.ancestor("li");n&&e.findFocus.call(this,n)}.bind(e)))})},findFocus:function(e){var t=e.one("a.photo");t?t.focus():e.one("a:first-child").focus()}})},"@VERSION@",{requires:["flickr-view","hermes-template-notifications"],langBundles:["common","notifications"],optional:["person-notifications-models","notification-view","photo-models","group-info-models","person-models","gallery-models"]});
YUI.add("notifications-menu-view",function(e){"use strict";e.namespace("Views")[this.name]=e.Base.create("notifications-menu-view",e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return this.pollingFailed=!1,this.shouldFetchNotifs=!0,this.notifFilter=["group_topic_new","user_gallery_comment"].join(","),this.get("container").get("innerHTML")===""&&this.setContainerWithTemplate("notifications-menu"),this},loadState:function(){var t=this,n=this.appContext.getViewer();return this.appContext.getModel("person-notifications-models",n.nsid).then(function(r){t.set("personNotificationsModel",r);if(Date.now()-r.getValue("unseenLastFetchedTimestamp")>e.config.flickr.notifications.loading_count_refetch_delay)return r.remoteReadUnseenNotificationCount({id:n.nsid,filter:t.notifFilter},t.appContext).then(null,function(e){t.pollingFailed=!0})})},buildContainer:function(){var e=this,t=e.formatCount99(e.get("personNotificationsModel").getValue("unseenNotificationCount"));return this.setContainerWithTemplate("notifications-menu",{unseenNotificationCount:t}),this},activate:function(){var e=this,t=e.get("personNotificationsModel");e.unseenBadge=e.get("container").one(".c-notification-unseencount"),e.unseenCount=0,e.notifIcon=e.get("container").one(".c-notification-icon"),t.getValue("unseenNotificationCount")===0?e.unseenBadge.addClass("hidden"):e.unseenBadge.removeClass("hidden"),this.registerEventHandler(this.get("container").on("click",e.openMenu.bind(e))),this.registerEventHandler(this.get("container").on("key",e.keyboardToggleMenu.bind(e),"down:13,32")),this.registerEventHandler(this.get("container").on("key",e.enterMenu.bind(e),"down:9,40")),e.pollForUnseenNotifs()},pollForUnseenNotifs:function(){this.pollIntervalId=setInterval(this.readUnseenNotifs.bind(this),e.config.flickr.notifications.polling_delay)},readUnseenNotifs:function(){var t=this,n=this.appContext.getViewer(),r=t.get("personNotificationsModel");r.remoteReadUnseenNotificationCount({id:n.nsid,filter:t.notifFilter},t.appContext).then(function(e){t.shouldFetchNotifs=!0,e!==t.unseenCount&&(t.unseenCount=e,e!==0?(t.unseenBadge.removeClass("hidden"),t.unseenBadge.set("text",t.formatCount99(e))):t.unseenBadge.addClass("hidden"))},function(n){clearInterval(t.pollIntervalId),t.pollingFailed||(t.pollingFailedTimeoutId=setTimeout(t.pollForUnseenNotifs.bind(t),e.config.flickr.notifications.polling_failure_timeout)),t.pollingFailed=!0})},openMenu:function(){this.revealNotifications()},keyboardToggleMenu:function(e){e.preventDefault(),!this.droparound||this.droparound.isClosed?this.revealNotifications():this.droparound.close()},enterMenu:function(e){var t=e.keyCode;if(t===9&&!e.shiftKey&&e.target.getAttribute("aria-expanded")==="true"||t===40){e.preventDefault();var n=this.droparound.get("container").one("div.notifs-droparound");if(n){var r=n.one("a.mail-icon");this.registerEventHandler(r.on("key",this.enterNotificationsList.bind(this),"down:9,40")),r.focus()}}},enterNotificationsList:function(e){var t=e.keyCode;if(t===9&&!e.shiftKey||t===40)e.preventDefault(),this.droparound.get("subview").findFocus.call(this,this.droparound.get("container").one("div.notifs-droparound").one("ul").one("li:first-child"))},revealNotifications:function(){var t=this.appContext.viewportData.getWidth(),n=this.appContext.viewportData.getHeight(),r=t>700?60:71,i=t>700?"":t-2+"px",s=n>1e3?"800px":n-200+"px",o;o=new e.Views["notifications-view"]({appContext:this.appContext,width:i,listHeight:s,shouldFetchNotifs:this.shouldFetchNotifs,notifFilter:this.notifFilter}),o.appContext=this.appContext,this.droparound=new e.Views.FluidDroparound({appContext:this.appContext,dismissOnOverlayClick:!0,dismissOnActionClick:!0,anchorOffsetVertical:-4,anchorOffsetHorizontal:r,mirrorArrowAdjustment:r-11,showDropArrow:!0,contentPadding:0,classList:"notifs-droparound no-border big-shadow",anchorElement:this.get("container").one(".c-notification-icon"),subview:o,observePageResize:!0,positionFixed:!0,autoSizeToContent:!0}),this.droparound.show(),this.unseenBadge.addClass("hidden"),this.shouldFetchNotifs=!1},formatCount99:function(e){return e>=100?"99+":e},destructor:function(){clearInterval(this.pollIntervalId),clearTimeout(this.pollingFailedTimeoutId)}})},"@VERSION@",{requires:["flickr-view","hermes-template-notifications-menu","fluid-droparound-view","notifications-view"],langBundles:["notifications","common"]});
